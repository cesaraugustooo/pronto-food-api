generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}
model Empresa {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  nome String @db.VarChar(255)
  slug String @db.VarChar(255) @unique
  ativo Boolean @default(true)
  inicio_exp String 
  fim_exp String 

  users User[]
  categorias Categoria[]
  produtos Produto[]
  pedidos Pedido[]

  @@map("empresas")
}

model User {
  id Int @id @default(autoincrement()) 
  createdAt DateTime @default(now())
  name String
  email String @unique @db.VarChar(255)
  password String @db.VarChar(255)
  empresa_id Int 
  empresa Empresa @relation(fields: [empresa_id],references: [id])

  @@map("users")
  @@index([empresa_id])
}

model Categoria {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  empresa_id Int
  nome String
  ativo Boolean @default(true)
  empresa Empresa @relation(fields: [empresa_id],references: [id], onDelete: Cascade)

  produtos Produto[]

  @@map("categorias")
  @@index([empresa_id])
}

model Produto {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  empresa_id Int
  categoria_id Int
  empresa Empresa @relation(fields: [empresa_id],references: [id])
  categoria Categoria @relation(fields: [categoria_id],references: [id])
  nome String
  ativo Boolean @default(true)
  descricao String? @db.Text 
  image String? @db.LongText  
  produto ProdutoHasPedido[]

  @@map("produtos")
  @@index([empresa_id])
  @@index([categoria_id])
}

enum PedidoStatus {
  Pendente
  Em_Producao
  Pronto  
}

model Pedido {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  numero Int 
  nome_cliente String
  telefone_cliente String
  endereco_cliente String
  observacoes_cliente String?
  total Float
  status PedidoStatus @default(Pendente)
  empresa_id Int
  empresa Empresa @relation(fields: [empresa_id],references: [id])

  pedido ProdutoHasPedido[]

  @@map("pedidos")
  @@index([empresa_id])
}

model ProdutoHasPedido {
  id Int @id @default(autoincrement())
  createdAt DateTime @default(now())
  produto_id Int
  pedido_id Int
  preco_snapshot Float
  nome_snapshot String
  produto Produto @relation(fields: [produto_id], references: [id])
  pedido Pedido @relation(fields: [pedido_id], references: [id])

  @@map("produto_has_pedido")
  @@index([produto_id])
  @@index([pedido_id])
}
